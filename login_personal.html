<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Personal - Los M√°s Chiludos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FDB515 0%, #F5A623 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            width: 100%;
            max-width: 450px;
        }

        .login-header {
            background: linear-gradient(135deg, #333 0%, #1a1a1a 100%);
            padding: 40px 30px;
            text-align: center;
            border-bottom: 5px solid #FDB515;
        }

        .logo-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .logo-text {
            font-size: 28px;
            font-weight: 900;
            color: #333;
            text-transform: uppercase;
            line-height: 1.2;
        }

        .logo-text .mas {
            font-size: 14px;
            display: block;
        }

        .logo-text .chiludos {
            color: #E94B3C;
            font-size: 32px;
        }

        .logo-text .restaurante {
            font-size: 10px;
            letter-spacing: 3px;
            color: #666;
        }

        .chile-icon {
            color: #E94B3C;
            font-size: 40px;
            display: inline-block;
            margin-bottom: -10px;
        }

        .staff-badge {
            background: #FDB515;
            color: #333;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            display: inline-block;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .welcome-text {
            color: white;
            font-size: 24px;
            font-weight: 700;
            margin-top: 10px;
        }

        .login-form {
            padding: 40px 30px;
        }

        .info-box {
            background: #fff9e6;
            border-left: 4px solid #FDB515;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .info-box p {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
            margin: 0;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #f9f9f9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #FDB515;
            background: white;
            box-shadow: 0 0 0 3px rgba(253, 181, 21, 0.1);
        }

        .form-group select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }

        .position-icon {
            font-size: 20px;
            margin-right: 8px;
        }

        .btn-login {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #333 0%, #1a1a1a 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #1a1a1a 0%, #000 100%);
        }

        .btn-login:active {
            transform: translateY(0);
        }

        .divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 1px;
            background: #e0e0e0;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            color: #999;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }

        .customer-link {
            text-align: center;
        }

        .customer-link p {
            color: #666;
            font-size: 14px;
        }

        .customer-link a {
            color: #E94B3C;
            text-decoration: none;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        .customer-link a:hover {
            color: #FDB515;
        }

        .security-note {
            background: #f0f8ff;
            border-left: 4px solid #0066cc;
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 25px;
        }

        .security-note p {
            color: #666;
            font-size: 12px;
            line-height: 1.5;
            margin: 0;
        }

        .security-note strong {
            color: #0066cc;
        }

        @media (max-width: 480px) {
            .login-container {
                max-width: 100%;
            }

            .login-header {
                padding: 30px 20px;
            }

            .login-form {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <div class="logo-container">
                <div class="logo-text">
                    <span class="chile-icon">üå∂Ô∏è</span>
                    <span class="mas">Los M√ÅS</span>
                    <span class="chiludos">CHILUDOS</span>
                    <span class="restaurante">RESTAURANTE</span>
                </div>
            </div>
            <div class="staff-badge">üëî Acceso Personal</div>
            <div class="welcome-text">Portal de Empleados</div>
        </div>

        <form class="login-form" id="staffLoginForm">
            <div class="info-box">
                <p>
                    üîí <strong>Acceso restringido:</strong> Este portal es exclusivo para personal autorizado de Los M√°s Chiludos.
                </p>
            </div>

            <div class="form-group">
                <label for="employeeId">ID de Empleado *</label>
                <input 
                    type="text" 
                    id="employeeId" 
                    name="employeeId" 
                    placeholder="Ingresa tu ID de empleado"
                    required
                >
            </div>

            <div class="form-group">
                <label for="password">Contrase√±a *</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    placeholder="Ingresa tu contrase√±a"
                    required
                >
            </div>

            <div class="form-group">
                <label for="position">Puesto *</label>
                <select id="position" name="position" required>
                    <option value="">Selecciona tu puesto</option>
                    <option value="admin">üë®‚Äçüíº Administrador</option>
                    <option value="mesero">üçΩÔ∏è Mesero</option>
                </select>
            </div>

            <button type="submit" class="btn-login">
                üîê Iniciar Sesi√≥n
            </button>

            <div class="security-note">
                <p>
                    <strong>üîí Seguridad:</strong> Todas las sesiones son monitoreadas. 
                    No compartas tus credenciales con nadie. Si olvidaste tu contrase√±a, 
                    contacta al administrador.
                </p>
            </div>

            <div class="divider">
                <span>o</span>
            </div>

            <div class="customer-link">
                <p>¬øEres cliente? <a href="login.html">Acceso de clientes aqu√≠</a></p>
            </div>
        </form>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';

        document.getElementById('staffLoginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const employeeId = document.getElementById('employeeId').value;
            const password = document.getElementById('password').value;
            const position = document.getElementById('position').value;
            const btnLogin = document.querySelector('.btn-login');

            // Validaciones b√°sicas
            if (!employeeId || !password || !position) {
                alert('‚ùå Por favor completa todos los campos');
                return;
            }

            // Deshabilitar bot√≥n durante la petici√≥n
            btnLogin.disabled = true;
            btnLogin.textContent = 'üîê Verificando...';

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userInput: employeeId,
                        password: password
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const usuario = data.data.usuario;

                    // Verificar que el rol del usuario coincida con el puesto seleccionado
                    if (usuario.rol !== position) {
                        alert(`‚ùå Error: Tu cuenta es de tipo "${usuario.rol}" pero seleccionaste "${position}"`);
                        btnLogin.disabled = false;
                        btnLogin.textContent = 'üîê Iniciar Sesi√≥n';
                        return;
                    }

                    // Verificar que el rol sea admin o mesero (no cliente)
                    if (usuario.rol !== 'admin' && usuario.rol !== 'mesero') {
                        alert('‚ùå Esta √°rea es solo para personal del restaurante');
                        btnLogin.disabled = false;
                        btnLogin.textContent = 'üîê Iniciar Sesi√≥n';
                        return;
                    }

                    // Guardar token y datos del usuario
                    localStorage.setItem('token', data.data.token);
                    localStorage.setItem('usuario', JSON.stringify(usuario));

                    // Mensaje de √©xito
                    const positionText = position === 'admin' ? 'üë®‚Äçüíº Administrador' : 'üçΩÔ∏è Mesero';
                    const confirmation = `
‚úÖ ACCESO AUTORIZADO

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìã INFORMACI√ìN DE SESI√ìN
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë§ Usuario: ${usuario.username}
üíº Puesto: ${positionText}
üïê Hora de acceso: ${new Date().toLocaleTimeString('es-MX')}
üìÖ Fecha: ${new Date().toLocaleDateString('es-MX')}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Bienvenido al sistema de Los M√°s Chiludos üå∂Ô∏è

${position === 'admin' ? 'üîß Accediendo al panel de administraci√≥n...' : 'üìã Accediendo al sistema de pedidos...'}
                    `;

                    alert(confirmation);

                    // Redirigir seg√∫n el puesto
                    if (position === 'admin') {
                        window.location.href = 'panel_admin.html';
                    } else if (position === 'mesero') {
                        window.location.href = 'panel_mesero.html';
                    }

                } else {
                    alert('‚ùå Error: ' + data.message);
                    btnLogin.disabled = false;
                    btnLogin.textContent = 'üîê Iniciar Sesi√≥n';
                }

            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error al conectar con el servidor. Aseg√∫rate de que el backend est√© corriendo.');
                btnLogin.disabled = false;
                btnLogin.textContent = 'üîê Iniciar Sesi√≥n';
            }
        });

        // Cambiar color del select seg√∫n el puesto seleccionado
        document.getElementById('position').addEventListener('change', function() {
            const position = this.value;
            const formGroup = this.closest('.form-group');
            
            if (position === 'admin') {
                this.style.borderColor = '#0066cc';
            } else if (position === 'mesero') {
                this.style.borderColor = '#FDB515';
            } else {
                this.style.borderColor = '#e0e0e0';
            }
        });
    </script>

</body>
</html>